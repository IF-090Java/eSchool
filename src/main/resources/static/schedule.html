<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="/css/global-style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns" crossorigin="anonymous">
<!-- CSS -->
<style type="text/css">
.error {
    color: red;
}
.main {
	margin-left: 15%;
	margin-right: 15%;
}
input {
	margin-left: 150px
}
select {
   -webkit-appearance: button;
   -webkit-border-radius: 2px;
   -webkit-box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1);
   -webkit-padding-end: 20px;
   -webkit-padding-start: 2px;
   -webkit-user-select: none;
   background-image: url(http://i62.tinypic.com/15xvbd5.png), -webkit-linear-gradient(#FAFAFA, #F4F4F4 40%, #E5E5E5);
   background-position: 97% center;
   background-repeat: no-repeat;
   border: 1px solid #AAA;
   color: #555;
   font-size: inherit;
   margin: 20px;
   overflow: hidden;
   padding: 5px 10px;
   text-overflow: ellipsis;
   white-space: nowrap;
   width: 300px;
 }
</style>
<head>
  <title>Schedule</title>
  <script src="/js/JS.js"></script>
</head>
<body>

<div class="wrapper">
  <div class="admin-sidebar"></div>
  <div class="container-fluid" style="padding-left: 0px; padding-right: 0px">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark d-flex justify-content-between" style="height: 78px">
      <span class="navbar-text">Ви увійшли як Адміністратор</span>
      <ul class="navbar-nav">
        <li class="nav-item active">
          <a class="nav-link" href="#" onclick="logOut()">Вийти</a>
        </li>
      </ul>
    </nav>

    <div class="container">
      <div id="message" align="center"></div>
      <!-- Text -->
      <div id="u1" align="center" style="padding-bottom:35px; padding-top:35px">
        <p><h1><span>Внесення розкладу</span></h1></p>
      </div>
      <div class="row">
        <div class="col">
          <div class="main">
            <!-- Text -->
            <div id="u13">
              <p class="control-label col-4 requiredField font-weight-bold">Виберіть межі семестру<span class="asteriskField">*</span></p>
            </div>

            <div class="container">
              <form id = "myForm">
              <div class="row">
                <!-- Unnamed (Rectangle) -->
                <div id="u3" class="ax_default label">
                  <label for="start" style="padding-bottom:15px; padding-top:25px">Введіть початок семетру:<span class="asteriskField">*</span></label>
                  <div class="controls col-8">
                    <input class="input-md form-control" id="start" type="date" name="startDate" >
                  </div>
                </div>
              </div>
              <div class="row">
                <!-- Unnamed (Rectangle) -->
                <div id="u6" class="ax_default label">
                  <label for="end" style="padding-bottom:15px; padding-top:25px">Введіть кінець семетру:<span class="asteriskField">*</span></label>
                  <div class="controls col-8">
                    <input class="input-md form-control" id="end" type="date" name="endDate" >
                  </div>
                </div>
              </div>
              </form>
            </div>

            <!-- Unnamed (Rectangle) -->
            <div id="u14" class="ax_default label">
              <p class="control-label col-4 requiredField font-weight-bold" style="padding-top:35px">Виберіть клас<span class="asteriskField">*</span></p>
            </div>

            <!-- Classes Droplist -->
            <div id="u15" class="ax_default droplist">
              <select id="u15_input">
              </select>
            </div>

            <!-- Unnamed (Rectangle) -->
            <div id="u19" class="ax_default label">
              <p style="text-decoration:underline;">Понеділок</p>
            </div>

            <ol>

              <!-- Subject (Droplist) -->
              <li id="u21" data-label="Subject">
                <select id="u21_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u23" data-label="Subject">
                <select id="u23_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u25" data-label="Subject">
                <select id="u25_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u27" data-label="Subject">
                <select id="u27_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u29" data-label="Subject">
                <select id="u29_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u31" data-label="Subject">
                <select id="u31_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u33" data-label="Subject">
                <select id="u33_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

            </ol>

            <!-- Unnamed (Rectangle) -->
            <div id="u67" class="ax_default label">
              <p style="text-decoration:underline;">Вівторок</p>
            </div>

            <ol>
              <!-- Subject (Droplist) -->
              <li id="u69" data-label="Subject">
                <select id="u69_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u71" data-label="Subject">
                <select id="u71_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u73" data-label="Subject">
                <select id="u73_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u75" data-label="Subject">
                <select id="u75_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u77" data-label="Subject">
                <select id="u77_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u79" data-label="Subject">
                <select id="u79_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u81" data-label="Subject">
                <select id="u81_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>
            </ol>

            <!-- Unnamed (Rectangle) -->
            <div id="u83" class="ax_default label">
              <p style="text-decoration:underline;">Середа</p>
            </div>

            <ol>
              <!-- Subject (Droplist) -->
              <li id="u85" data-label="Subject">
                <select id="u85_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u87" data-label="Subject">
                <select id="u87_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u89" data-label="Subject">
                <select id="u89_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u91" data-label="Subject">
                <select id="u91_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u93" data-label="Subject">
                <select id="u93_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u95" data-label="Subject">
                <select id="u95_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u97" data-label="Subject">
                <select id="u97_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>
            </ol>

            <!-- Unnamed (Rectangle) -->
            <div id="u35" class="ax_default label">
              <p style="text-decoration:underline;">Четвер</p>
            </div>

            <ol>
              <!-- Subject (Droplist) -->
              <li id="u37" data-label="Subject">
                <select id="u37_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u39" data-label="Subject">
                <select id="u39_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u41" data-label="Subject">
                <select id="u41_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u43" data-label="Subject">
                <select id="u43_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u45" data-label="Subject">
                <select id="u45_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u47" data-label="Subject">
                <select id="u47_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u49" data-label="Subject">
                <select id="u49_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>
            </ol>

            <!-- Unnamed (Rectangle) -->
            <div id="u51" class="ax_default label">
              <p style="text-decoration:underline;">П'ятниця</p>
            </div>

            <ol>
              <!-- Subject (Droplist) -->
              <li id="u53" data-label="Subject">
                <select id="u53_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u55" data-label="Subject">
                <select id="u55_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u57" data-label="Subject">
                <select id="u57_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u59" data-label="Subject">
                <select id="u59_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u61" data-label="Subject">
                <select id="u61_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u63" data-label="Subject">
                <select id="u63_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>

              <!-- Subject (Droplist) -->
              <li id="u65" data-label="Subject">
                <select id="u65_input" class="ax_default_droplist">
                  <option value="0">-</option>
                </select>
              </li>
            </ol>


            <!-- Unnamed (Rectangle) -->
            <div id="u17" align="center" style="text-align: center; margin: 0 auto; padding-top: 25px; padding-bottom: 100px">
              <button id="submitButton" class="btn btn-success" type="submit">Створити розклад</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        refreshToken();
        $.ajaxSetup({
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " +localStorage.getItem("jwtToken"))
            }
        })
    })

		$(document).ready(function() {

            var today = new Date();
            var one_day_ago=new Date().setDate(today.getDate()-1);
            var dd = today.getDate();
            var mm = today.getMonth()+1; //January is 0!
            var yyyy = today.getFullYear();
             if(dd<10){
                    dd='0'+dd
                }
                if(mm<10){
                    mm='0'+mm
                }

            today = yyyy+'-'+mm+'-'+dd;

           jQuery.validator.addMethod("minDate", function(value, element) {
                 var inputDate = new Date(value);
                  if (inputDate > one_day_ago)
                      return true;
                  return false;
          }, "Дата повинна бути більшою чи рівною " + today);

          jQuery.validator.addMethod("enddate", function(value, element) {
            var startdatevalue = $("#start").val();
            if (new Date(startdatevalue) < new Date(value))
                      return true;
                  return false;
            }, "Дата кінця семетру повинна бути більшою чим дата початку семестру");

          $("#myForm").validate({
            rules: {
                startDate: {
                    required: true,
                    date: true,
                    minDate: true
                },
                endDate: {
                    required: true,
                    date: true,
                    enddate : true
                }
            },
            messages: {
             startDate: {
                    required: "Це поле обов'язкове"
                },
                endDate: {
                    required: "Це поле обов'язкове"
                }
            }
        });

			$.getJSON(host + 'subjects', function (data) {

				var subjectNames = [];
				var id = [];
				$.each(data, function(key, value) {
						subjectNames.push(value.subjectName);
						id.push(value.subjectId);
					});
				for (i=0; i < subjectNames.length; i++)
				{
					$('.ax_default_droplist').append('<option value="' + id[i] + '">' + subjectNames[i] + '</option>');
				}
			}).fail(function (data) {
                if (data.status == 403){
                    window.location.href='/ui/login'
                }
            });

			$.getJSON(host + 'classes', function(data){

					var classNames = [];
					var id = [];
					$.each(data, function(key, value) {
						classNames.push(value.className);
						id.push(value.id);
					});
					for (i=0; i < classNames.length; i++)
					$('#u15_input').append('<option value="' + id[i] + '">' + classNames[i] + '</option>');
				});


			$('#submitButton').click(function(){
				var startdate = $('#start').val();
				var enddate = $('#end').val();

				var classObj = {id: $('#u15_input').find(":selected").val(), classYear: (new Date()).getFullYear(),
				className: $("#u15_input").find('option:selected').text(), classDescription: " ", isActive: "true"};
				id_class = $('#u15_input').find(":selected").val();

				var monday = [];
				var tuesday = [];
				var wednesday = [];
				var thursday = [];
				var friday = [];

				monday.push({subjectId: $('#u21_input').find(":selected").val(), subjectName: $('#u21_input').find("option:selected").text(), subjectDescription: ""});
				monday.push({subjectId: $('#u23_input').find(":selected").val(), subjectName: $('#u23_input').find("option:selected").text(), subjectDescription: ""});
				monday.push({subjectId: $('#u25_input').find(":selected").val(), subjectName: $('#u25_input').find("option:selected").text(), subjectDescription: ""});
				monday.push({subjectId: $('#u27_input').find(":selected").val(), subjectName: $('#u27_input').find("option:selected").text(), subjectDescription: ""});
				monday.push({subjectId: $('#u29_input').find(":selected").val(), subjectName: $('#u29_input').find("option:selected").text(), subjectDescription: ""});
				monday.push({subjectId: $('#u31_input').find(":selected").val(), subjectName: $('#u31_input').find("option:selected").text(), subjectDescription: ""});
				monday.push({subjectId: $('#u33_input').find(":selected").val(), subjectName: $('#u33_input').find("option:selected").text(), subjectDescription: ""});

                tuesday.push({subjectId: $('#u69_input').find(":selected").val(), subjectName: $('#u69_input').find("option:selected").text(), subjectDescription: ""});
				tuesday.push({subjectId: $('#u71_input').find(":selected").val(), subjectName: $('#u71_input').find("option:selected").text(), subjectDescription: ""});
				tuesday.push({subjectId: $('#u73_input').find(":selected").val(), subjectName: $('#u73_input').find("option:selected").text(), subjectDescription: ""});
				tuesday.push({subjectId: $('#u75_input').find(":selected").val(), subjectName: $('#u75_input').find("option:selected").text(), subjectDescription: ""});
				tuesday.push({subjectId: $('#u77_input').find(":selected").val(), subjectName: $('#u77_input').find("option:selected").text(), subjectDescription: ""});
				tuesday.push({subjectId: $('#u79_input').find(":selected").val(), subjectName: $('#u79_input').find("option:selected").text(), subjectDescription: ""});
				tuesday.push({subjectId: $('#u81_input').find(":selected").val(), subjectName: $('#u81_input').find("option:selected").text(), subjectDescription: ""});

				wednesday.push({subjectId: $('#u85_input').find(":selected").val(), subjectName: $('#u85_input').find("option:selected").text(), subjectDescription: ""});
				wednesday.push({subjectId: $('#u87_input').find(":selected").val(), subjectName: $('#u87_input').find("option:selected").text(), subjectDescription: ""});
				wednesday.push({subjectId: $('#u89_input').find(":selected").val(), subjectName: $('#u98_input').find("option:selected").text(), subjectDescription: ""});
				wednesday.push({subjectId: $('#u91_input').find(":selected").val(), subjectName: $('#u91_input').find("option:selected").text(), subjectDescription: ""});
				wednesday.push({subjectId: $('#u93_input').find(":selected").val(), subjectName: $('#u93_input').find("option:selected").text(), subjectDescription: ""});
				wednesday.push({subjectId: $('#u95_input').find(":selected").val(), subjectName: $('#u95_input').find("option:selected").text(), subjectDescription: ""});
				wednesday.push({subjectId: $('#u97_input').find(":selected").val(), subjectName: $('#u97_input').find("option:selected").text(), subjectDescription: ""});

				thursday.push({subjectId: $('#u37_input').find(":selected").val(), subjectName: $('#u37_input').find("option:selected").text(), subjectDescription: ""});
				thursday.push({subjectId: $('#u39_input').find(":selected").val(), subjectName: $('#u39_input').find("option:selected").text(), subjectDescription: ""});
				thursday.push({subjectId: $('#u41_input').find(":selected").val(), subjectName: $('#u41_input').find("option:selected").text(), subjectDescription: ""});
				thursday.push({subjectId: $('#u43_input').find(":selected").val(), subjectName: $('#u43_input').find("option:selected").text(), subjectDescription: ""});
				thursday.push({subjectId: $('#u45_input').find(":selected").val(), subjectName: $('#u45_input').find("option:selected").text(), subjectDescription: ""});
				thursday.push({subjectId: $('#u47_input').find(":selected").val(), subjectName: $('#u47_input').find("option:selected").text(), subjectDescription: ""});
				thursday.push({subjectId: $('#u49_input').find(":selected").val(), subjectName: $('#u49_input').find("option:selected").text(), subjectDescription: ""});

				friday.push({subjectId: $('#u53_input').find(":selected").val(), subjectName: $('#u53_input').find("option:selected").text(), subjectDescription: ""});
				friday.push({subjectId: $('#u55_input').find(":selected").val(), subjectName: $('#u55_input').find("option:selected").text(), subjectDescription: ""});
				friday.push({subjectId: $('#u57_input').find(":selected").val(), subjectName: $('#u57_input').find("option:selected").text(), subjectDescription: ""});
				friday.push({subjectId: $('#u59_input').find(":selected").val(), subjectName: $('#u59_input').find("option:selected").text(), subjectDescription: ""});
				friday.push({subjectId: $('#u61_input').find(":selected").val(), subjectName: $('#u61_input').find("option:selected").text(), subjectDescription: ""});
				friday.push({subjectId: $('#u63_input').find(":selected").val(), subjectName: $('#u63_input').find("option:selected").text(), subjectDescription: ""});
				friday.push({subjectId: $('#u65_input').find(":selected").val(), subjectName: $('#u65_input').find("option:selected").text(), subjectDescription: ""});

                function deleteFromArray(array)
                {
                  var array2 = [];
                  for (i=0; i<array.length; i++){
                    if (array[i].subjectId != 0) { array2.push(array[i]);}
                    }
                   return array2;
                }

				$.ajax({
                type: "post",
                url: host + "classes/" + id_class + "/schedule",
                dataType: "json",
                data: JSON.stringify({
                  "startOfSemester":startdate,
                  "endOfSemester":enddate,
                  "className":classObj,
                  "mondaySubjects":deleteFromArray(monday),
                  "tuesdaySubjects":deleteFromArray(tuesday),
                  "wednesdaySubjects":deleteFromArray(wednesday),
                  "thursdaySubjects":deleteFromArray(thursday),
                  "fridaySubjects":deleteFromArray(friday)
                }),
                contentType: "application/json",
  				  statusCode: {
                       200: function() {
                        $("#message").attr("class", "alert alert-success");
                        $("#message").html("<strong>Розклад успішно створений</strong>");
                    },
                      201: function() {
                      $("#message").attr("class", "alert alert-success");
                      $("#message").html("<strong>Розклад успішно створений</strong>");
                    },
                      500: function() {
                      $("#message").attr("class", "alert alert-danger");
                      $("#message").html("<strong>Внутрішня помилка сервера</strong>");
                    }
                  },
                    success: function (responce) {
                        $("#start").val("");
                        $("#end").val("");
                          document.getElementById('u21_input').selectedIndex = 0;
                          document.getElementById('u23_input').selectedIndex = 0;
                          document.getElementById('u25_input').selectedIndex = 0;
                          document.getElementById('u27_input').selectedIndex = 0;
                          document.getElementById('u29_input').selectedIndex = 0;
                          document.getElementById('u31_input').selectedIndex = 0;
                          document.getElementById('u33_input').selectedIndex = 0;

                          document.getElementById('u69_input').selectedIndex = 0;
                          document.getElementById('u71_input').selectedIndex = 0;
                          document.getElementById('u73_input').selectedIndex = 0;
                          document.getElementById('u75_input').selectedIndex = 0;
                          document.getElementById('u77_input').selectedIndex = 0;
                          document.getElementById('u79_input').selectedIndex = 0;
                          document.getElementById('u81_input').selectedIndex = 0;

                          document.getElementById('u85_input').selectedIndex = 0;
                          document.getElementById('u87_input').selectedIndex = 0;
                          document.getElementById('u89_input').selectedIndex = 0;
                          document.getElementById('u91_input').selectedIndex = 0;
                          document.getElementById('u93_input').selectedIndex = 0;
                          document.getElementById('u95_input').selectedIndex = 0;
                          document.getElementById('u97_input').selectedIndex = 0;

                          document.getElementById('u37_input').selectedIndex = 0;
                          document.getElementById('u39_input').selectedIndex = 0;
                          document.getElementById('u41_input').selectedIndex = 0;
                          document.getElementById('u43_input').selectedIndex = 0;
                          document.getElementById('u45_input').selectedIndex = 0;
                          document.getElementById('u47_input').selectedIndex = 0;
                          document.getElementById('u49_input').selectedIndex = 0;

                          document.getElementById('u53_input').selectedIndex = 0;
                          document.getElementById('u55_input').selectedIndex = 0;
                          document.getElementById('u57_input').selectedIndex = 0;
                          document.getElementById('u59_input').selectedIndex = 0;
                          document.getElementById('u61_input').selectedIndex = 0;
                          document.getElementById('u63_input').selectedIndex = 0;
                          document.getElementById('u65_input').selectedIndex = 0;

                    }

            });
		})
	})
	</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script type="text/javascript">
    $(function() {
        $(".admin-sidebar").load("/views/admin-sidebar.html");
    });
</script>
</body>
</html>
